<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºæŠ¥å‘Šç®¡ç†ç³»ç»Ÿ - ç®¡ç†åå°</title>
    <style>
        /* Global reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #fdf2f8 0%, #f8f4ff 100%); /* Pink gradient background */
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #374151; /* Main text color */
            min-height: 100vh;
        }

        /* Top admin bar styles */
        .admin-bar {
            background: linear-gradient(90deg, #f472b6 0%, #c084fc 100%); /* Gradient matching sidebar */
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            position: fixed; /* Fixed at top */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1002; /* Ensure on top layer */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-status {
            background: #10b981; /* Online status green */
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .github-status {
            background: #6366f1;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Navigation sidebar styles */
        .nav-sidebar {
            position: fixed;
            top: 44px; /* Offset from admin bar */
            left: 0;
            width: 260px;
            height: calc(100vh - 44px); /* Subtract admin bar height */
            background: linear-gradient(180deg, #f472b6 0%, #c084fc 100%); /* Pink to purple gradient */
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease; /* Smooth transition */
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
        }

        .nav-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* Light separator */
        }

        .nav-header h3 {
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .nav-header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85em;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 20px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent; /* No border in inactive state */
            font-size: 0.95em;
            cursor: pointer;
            margin: 2px 0;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.15); /* Hover background */
            color: white;
            border-left-color: white; /* Hover left border */
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2); /* Active background */
            color: white;
            border-left-color: white; /* Active left border */
            font-weight: 600;
        }

        .nav-item .emoji {
            margin-right: 10px;
            font-size: 1.1em;
        }

        /* Mobile navigation toggle button styles */
        .nav-toggle {
            display: none; /* Hidden by default */
            position: fixed;
            top: 54px; /* Offset from admin bar */
            left: 20px;
            z-index: 1001; /* Higher than sidebar */
            background: #f472b6;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Main content area styles */
        .main-content {
            margin-left: 260px; /* Space for sidebar */
            margin-top: 44px; /* Space for admin bar */
            padding: 20px;
            min-height: calc(100vh - 44px); /* Subtract admin bar height */
        }

        .container {
            max-width: 1400px;
            margin: 0 auto; /* Center align */
        }

        /* Page header styles */
        .page-header {
            background: rgba(255, 255, 255, 0.8); /* Semi-transparent white background */
            backdrop-filter: blur(10px); /* Frosted glass effect */
            border-radius: 8px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Soft shadow */
            border-left: 4px solid #f472b6; /* Left border in theme color */
        }

        .page-header h1 {
            color: #ec4899; /* Theme pink */
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .page-header p {
            color: #6b7280;
            font-size: 0.95em;
        }

        /* Page content area styles */
        .page-content {
            background: rgba(255, 255, 255, 0.8); /* Semi-transparent white background */
            backdrop-filter: blur(10px); /* Frosted glass effect */
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Soft shadow */
            min-height: 60vh;
        }

        .page-content.hidden {
            display: none; /* Hide inactive pages */
        }

        /* GitHub setup banner */
        .github-setup-banner {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .github-setup-banner.connected {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .setup-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setup-config {
            display: grid;
            gap: 15px;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .config-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        /* Common button styles */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f472b6, #c084fc); /* Theme gradient */
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            box-shadow: 0 4px 10px rgba(244, 114, 182, 0.3);
        }

        .btn-secondary {
            background: #6b7280; /* Gray */
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8em;
        }

        /* Latest report page styles */
        .latest-report-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .report-card-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 25px;
        }

        .report-display {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .report-header-card {
            background: #f9fafb;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Wrap for small screens */
            gap: 10px;
        }

        .report-info h3 {
            color: #1f2937;
            font-size: 1.3em;
            margin-bottom: 2px;
        }

        .report-info p {
            color: #6b7280;
            font-size: 0.9em;
        }

        .report-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .report-iframe {
            height: 600px; /* Report iframe height */
            border: none;
            width: 100%;
        }

        .no-report {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
            border: 1px dashed #e5e7eb;
            border-radius: 8px;
            background: rgba(255,255,255,0.5);
        }

        .no-report .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* History reports page styles */
        .controls-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .controls-row {
            display: flex;
            gap: 20px;
            align-items: flex-end; /* Align to bottom */
            flex-wrap: wrap; /* Wrap for small screens */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 120px;
        }

        .form-group label {
            color: #374151;
            font-weight: 500;
            font-size: 0.9em;
        }

        .form-control {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9em;
            background: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #f472b6;
            box-shadow: 0 0 0 3px rgba(244, 114, 182, 0.2);
        }

        /* Reports table styles */
        .reports-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .reports-table th,
        .reports-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .reports-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            font-size: 0.9em;
        }

        .reports-table td {
            font-size: 0.9em;
            color: #6b7280;
        }

        .reports-table tr:hover {
            background: #fdf2f8; /* Hover background color */
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-available {
            background: #d1fae5; /* Green background */
            color: #065f46; /* Green text */
        }

        .status-missing {
            background: #fee2e2; /* Red background */
            color: #991b1b; /* Red text */
        }
        .status-na {
            background: #e0e7ff; /* Blue-ish background */
            color: #4338ca; /* Blue-ish text */
        }

        .table-actions {
            display: flex;
            gap: 5px;
        }

        /* Backup and download page styles */
        .admin-section {
            background: #fffbe6; /* Warning yellow background */
            border: 1px solid #fcd34d; /* Warning yellow border */
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
            color: #78350f; /* Warning text color */
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-section h4 {
            color: #b45309;
            margin: 0;
            font-size: 1.1em;
        }

        .admin-section p {
            margin: 0;
            font-size: 0.9em;
        }

        .upload-section {
            border: 2px dashed #f472b6; /* Theme color dashed border */
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.5); /* Semi-transparent background */
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .upload-section:hover {
            border-color: #ec4899;
            background: rgba(255, 255, 255, 0.8);
        }

        .upload-section.dragover {
            border-color: #ec4899;
            background: rgba(244, 114, 182, 0.1); /* Dragging background color */
        }

        #fileInput {
            display: none;
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .management-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            cursor: pointer; /* Make cards clickable */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .management-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .management-card h4 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .management-card p {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        /* File naming rules description */
        .naming-rules {
            background: #e0f2fe; /* Info blue background */
            border: 1px solid #90cdf4; /* Info blue border */
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #2b6cb0;
        }

        .naming-rules h4 {
            color: #2c5282;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .naming-rules ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .naming-rules li {
            margin: 8px 0;
            font-size: 0.9em;
        }

        .example-box {
            background: white;
            border: 1px solid #b3e5fc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
            overflow-x: auto; /* Prevent code overflow */
        }
        
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000; /* Higher than all content */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* Semi-transparent black background */
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            border-radius: 12px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content h3 {
            color: #ec4899;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .modal-content p {
            margin-bottom: 25px;
            color: #6b7280;
        }

        .modal-content input[type="password"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1em;
        }

        .modal-content .btn {
            margin: 0 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading indicator */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
            font-size: 1.2em;
            color: #374151;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f472b6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Statistics page specific styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-card .icon {
            font-size: 3em;
            margin-bottom: 10px;
            color: #c084fc;
        }

        .stat-card h5 {
            font-size: 1.5em;
            color: #ec4899;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #6b7280;
            font-size: 0.9em;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9em;
            color: #374151;
        }

        .stats-table th {
            background: #f9fafb;
            font-weight: 600;
        }
        .stats-table tbody tr:hover {
            background: #fdf2f8;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .nav-sidebar {
                transform: translateX(-100%); /* Hidden by default */
                box-shadow: none;
            }

            .nav-sidebar.open {
                transform: translateX(0); /* Show */
                box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            }

            .nav-toggle {
                display: block; /* Show mobile toggle button */
            }

            .main-content {
                margin-left: 0; /* Remove left margin */
                padding: 80px 15px 20px 15px; /* Adjust top and horizontal padding */
            }

            .admin-bar {
                padding: 10px 15px;
            }
            .admin-info span:last-child {
                display: none; /* Hide time */
            }

            .page-header, .page-content {
                padding: 15px; /* Adjust padding */
            }

            .controls-row {
                flex-direction: column; /* Vertical arrangement for filters */
                align-items: stretch;
            }

            .form-group {
                min-width: auto;
            }

            .reports-table {
                font-size: 0.8em; /* Smaller table font */
                display: block; /* Allow horizontal scrolling for table */
                overflow-x: auto;
                white-space: nowrap;
            }

            .management-grid {
                grid-template-columns: 1fr; /* Single column layout */
            }

            .report-display {
                margin: 0 -15px 25px -15px; /* Extend to edges */
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .report-header-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .report-iframe {
                height: 400px; /* Mobile iframe height */
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .config-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Modal for admin authentication -->
    <div id="adminAuthModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ”’ ç®¡ç†å‘˜éªŒè¯</h3>
            <p>è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç»§ç»­æ“ä½œã€‚</p>
            <input type="password" id="adminPasswordInput" placeholder="è¯·è¾“å…¥å¯†ç ">
            <button class="btn btn-primary" onclick="checkAdminPassword()">ç¡®è®¤</button>
            <button class="btn btn-secondary" onclick="closeAdminAuthModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- Loading indicator -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</p>
        <p id="loadingMessage"></p>
    </div>

    <!-- Admin top bar -->
    <div class="admin-bar">
        <div class="admin-info">
            <span>ğŸ“Š ç«ç‘°-å“ç±» æŠ¥å‘Šç®¡ç†ç³»ç»Ÿ</span>
            <span class="admin-status">ç®¡ç†å‘˜</span>
            <span class="github-status" id="githubStatus">GitHubæœªè¿æ¥</span>
            <span>|</span>
            <span>å½“å‰æ—¶é—´: <span id="currentTime"></span></span>
        </div>
        <div>
            <span>æ•°æ®æ›´æ–°: <span id="lastUpdate">2025-08-18</span></span>
        </div>
    </div>

    <!-- Navigation sidebar -->
    <nav class="nav-sidebar" id="navSidebar">
        <div class="nav-header">
            <h3>ç«ç‘°-å“ç±» æŠ¥å‘Šç®¡ç†é¢æ¿</h3>
            <p>å¸‚åœºè¶‹åŠ¿æŠ¥å‘Šç®¡ç†</p>
        </div>
        <div class="nav-menu">
            <a href="#" class="nav-item active" data-page="latest">
                <span class="emoji">ğŸ“„</span>æœ€æ–°æŠ¥å‘Š
            </a>
            <a href="#" class="nav-item" data-page="history">
                <span class="emoji">ğŸ“š</span>å†å²æŠ¥å‘Šå½’æ¡£
            </a>
            <a href="#" class="nav-item" data-page="backup">
                <span class="emoji">ğŸ”§</span>å¤‡ä»½å’Œä¸‹è½½
            </a>
        </div>
    </nav>

    <!-- Mobile navigation toggle button -->
    <button class="nav-toggle" id="navToggle">â˜°</button>

    <!-- Main content area -->
    <div class="main-content">
        <div class="container">
            <!-- GitHub Setup Banner -->
            <div id="githubSetupBanner" class="github-setup-banner">
                <div class="setup-info">
                    <span style="font-size: 1.5em;">âš™ï¸</span>
                    <div>
                        <strong>GitHubäº‘ç«¯å­˜å‚¨é…ç½®</strong>
                        <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">é…ç½®GitHubä»“åº“ä»¥å®ç°äº‘ç«¯å­˜å‚¨å’Œå¤šç”¨æˆ·åŒæ­¥</p>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="toggleGitHubSetup()">é…ç½®</button>
            </div>

            <!-- GitHub Configuration Section -->
            <div id="githubConfig" class="setup-config" style="display: none;">
                <h3 style="text-align: center; color: #374151; margin-bottom: 20px;">ğŸ”§ GitHubé…ç½®</h3>
                <div class="config-form">
                    <div class="form-group">
                        <label for="githubUsername">GitHubç”¨æˆ·å</label>
                        <input type="text" id="githubUsername" class="form-control" placeholder="your-username">
                    </div>
                    <div class="form-group">
                        <label for="githubRepo">ä»“åº“åç§°</label>
                        <input type="text" id="githubRepo" class="form-control" placeholder="report-storage">
                    </div>
                    <div class="form-group">
                        <label for="githubToken">è®¿é—®ä»¤ç‰Œ</label>
                        <input type="password" id="githubToken" class="form-control" placeholder="ghp_xxxxxxxxxxxx">
                    </div>
                    <button class="btn btn-primary" onclick="connectGitHub()">ğŸ”— è¿æ¥GitHub</button>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 6px; border: 1px solid #0ea5e9; font-size: 0.9em; color: #0369a1;">
                    <strong>é…ç½®è¯´æ˜ï¼š</strong>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>åœ¨GitHubåˆ›å»ºç§æœ‰ä»“åº“ï¼ˆå»ºè®®åç§°ï¼šreport-storageï¼‰</li>
                        <li>ç”ŸæˆPersonal Access Tokenï¼Œå‹¾é€‰repoæƒé™</li>
                        <li>å¡«å†™ä¸Šè¿°ä¿¡æ¯å¹¶ç‚¹å‡»è¿æ¥</li>
                    </ol>
                </div>
            </div>

            <!-- Page header -->
            <div class="page-header">
                <h1 id="pageTitle">æœ€æ–°æŠ¥å‘Š</h1>
                <p id="pageDescription">æŸ¥çœ‹å’Œç®¡ç†å½“å‰æœ€æ–°å‘å¸ƒçš„æŠ¥å‘Š</p>
            </div>

            <!-- Latest report page -->
            <div id="latestPage" class="page-content">
                <div class="latest-report-container" id="latestReportsContainer">
                    <!-- Latest Market Trends Report -->
                    <div id="latestTrendsReportDisplay" class="no-report">
                        <div class="icon">ğŸ“ˆ</div>
                        <h3>æš‚æ— æœ€æ–°å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š</h3>
                        <p>è¯·å…ˆä¸Šä¼ å½“å‰æœˆä»½çš„å¸‚åœºè¶‹åŠ¿HTMLæŠ¥å‘Šæ–‡ä»¶</p>
                        <button class="btn btn-primary" onclick="switchToAdminPage('backup')" style="margin-top: 15px;">
                            ğŸ“¤ å»ä¸Šä¼ æŠ¥å‘Š
                        </button>
                    </div>

                    <!-- Latest Market Data Report -->
                    <div id="latestDataReportDisplay" class="no-report" style="margin-top: 25px;">
                        <div class="icon">ğŸ“Š</div>
                        <h3>æš‚æ— æœ€æ–°å¸‚åœºæ•°æ®æœˆæŠ¥</h3>
                        <p>è¯·å…ˆä¸Šä¼ å½“å‰æœˆä»½çš„å¸‚åœºæ•°æ®HTMLæŠ¥å‘Šæ–‡ä»¶</p>
                        <button class="btn btn-primary" onclick="switchToAdminPage('backup')" style="margin-top: 15px;">
                            ğŸ“¤ å»ä¸Šä¼ æŠ¥å‘Š
                        </button>
                    </div>
                </div>
            </div>

            <!-- History reports page -->
            <div id="historyPage" class="page-content hidden">
                <div class="controls-section">
                    <div class="controls-row">
                        <div class="form-group">
                            <label for="yearSelect">å¹´ä»½</label>
                            <select id="yearSelect" class="form-control" onchange="filterReports()">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="2025" selected>2025å¹´</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="monthSelect">æœˆä»½</label>
                            <select id="monthSelect" class="form-control" onchange="filterReports()">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="01">1æœˆ</option>
                                <option value="02">2æœˆ</option>
                                <option value="03">3æœˆ</option>
                                <option value="04">4æœˆ</option>
                                <option value="05">5æœˆ</option>
                                <option value="06">6æœˆ</option>
                                <option value="07" selected>7æœˆ</option>
                                <option value="08">8æœˆ</option>
                                <option value="09">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="typeSelect">æŠ¥å‘Šç±»å‹</label>
                            <select id="typeSelect" class="form-control" onchange="filterReports()">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="market-trends">å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š</option>
                                <option value="market-data">å¸‚åœºæ•°æ®æœˆæŠ¥</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-secondary" onclick="resetFilters()">é‡ç½®ç­›é€‰</button>
                        </div>
                    </div>
                </div>

                <table class="reports-table">
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šåç§°</th>
                            <th>ç±»å‹</th>
                            <th>æ—¥æœŸ</th>
                            <th>HTMLçŠ¶æ€</th>
                            <th>PDFçŠ¶æ€</th>
                            <th>ExcelçŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Report list will be dynamically generated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Backup and download page -->
            <div id="backupPage" class="page-content hidden">
                <div class="admin-section">
                    <span style="font-size: 1.5em;">âš ï¸</span>
                    <div>
                        <h4>ç®¡ç†å‘˜åŠŸèƒ½</h4>
                        <p>æ­¤é¡µé¢ä»…é™ç®¡ç†å‘˜æ“ä½œï¼Œè¯·ç¡®è®¤æ‚¨æœ‰ç›¸åº”æƒé™åå†è¿›è¡Œæ“ä½œã€‚</p>
                    </div>
                </div>

                <div class="naming-rules">
                    <h4><span class="emoji">ğŸ“‹</span> æ–‡ä»¶å‘½åè§„èŒƒ</h4>
                    <p><strong>ä¸ºç¡®ä¿ç³»ç»Ÿæ­£ç¡®è¯†åˆ«æŠ¥å‘Šç±»å‹å’Œæœˆä»½ï¼Œè¯·æŒ‰ä»¥ä¸‹è§„èŒƒå‘½åæ–‡ä»¶ï¼š</strong></p>
                    <ul>
                        <li><strong>å¸‚åœºè¶‹åŠ¿æŠ¥å‘Šï¼š</strong> <code>market-trends-YYYYMM.html</code> æˆ– <code>market-trends-YYYYMM.pdf</code></li>
                        <li><strong>å¸‚åœºæ•°æ®æœˆæŠ¥ï¼š</strong> <code>market-data-YYYYMM.html</code> æˆ– <code>market-data-YYYYMM.xlsx</code> (æˆ– .xls)</li>
                    </ul>
                    <div class="example-box">
                        <strong>ç¤ºä¾‹ï¼š</strong><br>
                        <code>market-trends-202507.html</code> (2025å¹´7æœˆå¸‚åœºè¶‹åŠ¿æŠ¥å‘Šçš„HTMLç‰ˆæœ¬)<br>
                        <code>market-data-202507.xlsx</code> (2025å¹´7æœˆå¸‚åœºæ•°æ®æœˆæŠ¥çš„Excelç‰ˆæœ¬)<br>
                        <code>market-trends-202507.pdf</code> (2025å¹´7æœˆå¸‚åœºè¶‹åŠ¿æŠ¥å‘Šçš„PDFç‰ˆæœ¬)
                    </div>
                    <p><strong>æ³¨æ„ï¼š</strong>æ–‡ä»¶åå¿…é¡»å®Œå…¨æŒ‰ç…§æ­¤æ ¼å¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£ææ–‡ä»¶ç±»å‹å’Œæ—¥æœŸä¿¡æ¯ï¼Œå¹¶å…³è”ç›¸åŒæ—¥æœŸå’Œç±»å‹çš„HTMLã€PDFæˆ–Excelæ–‡ä»¶ã€‚</p>
                </div>

                <div class="upload-section" onclick="triggerFileInput()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“</div>
                    <h3>ä¸Šä¼ æŠ¥å‘Šæ–‡ä»¶</h3>
                    <p style="margin: 10px 0;">æ‹–æ‹½HTML, PDFæˆ–Excelæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <p style="font-size: 0.9em; color: #6b7280;">æ”¯æŒHTML, PDF, Excelæ ¼å¼ï¼Œè¯·æŒ‰å‘½åè§„èŒƒä¸Šä¼ </p>
                    <p style="font-size: 0.8em; color: #dc2626; margin-top: 10px;">âš ï¸ æ­¤åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜æƒé™</p>
                    <button class="btn btn-primary" style="margin-top: 15px;">é€‰æ‹©æ–‡ä»¶</button>
                </div>

                <input type="file" id="fileInput" accept=".html,.htm,.pdf,.xls,.xlsx" onchange="handleFileSelect(event)">

                <div class="management-grid">
                    <div class="management-card" onclick="showDownloadStats()">
                        <h4>ğŸ“¦ ä¸‹è½½ç»Ÿè®¡</h4>
                        <p>æŸ¥çœ‹æŠ¥å‘Šçš„ä¸‹è½½è¶‹åŠ¿å’Œç»Ÿè®¡æ•°æ®ã€‚</p>
                        <button class="btn btn-secondary">æŸ¥çœ‹ç»Ÿè®¡</button>
                    </div>

                    <div class="management-card" onclick="showSystemStats()">
                        <h4>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h4>
                        <p>æŸ¥çœ‹ç³»ç»Ÿå­˜å‚¨ç»Ÿè®¡å’ŒæŠ¥å‘Šä¸Šä¼ æƒ…å†µã€‚</p>
                        <button class="btn btn-secondary">æŸ¥çœ‹ç»Ÿè®¡</button>
                    </div>

                    <div class="management-card" onclick="showFileManagement()">
                        <h4>ğŸ—‘ï¸ æ–‡ä»¶ç®¡ç†</h4>
                        <p>ç®¡ç†å·²ä¸Šä¼ æ–‡ä»¶ï¼Œæ”¯æŒåˆ é™¤å’Œé‡æ–°ä¸Šä¼ æ“ä½œã€‚</p>
                        <button class="btn btn-secondary">æ–‡ä»¶ç®¡ç†</button>
                    </div>
                </div>
            </div>

            <!-- Download Statistics Page -->
            <div id="downloadStatsPage" class="page-content hidden">
                <button class="btn btn-secondary" onclick="switchToAdminPage('backup')" style="margin-bottom: 20px;">
                    â¬…ï¸ è¿”å›å¤‡ä»½å’Œä¸‹è½½
                </button>
                <h2>ğŸ“¥ ä¸‹è½½ç»Ÿè®¡</h2>
                <p>æ­¤å¤„æ˜¾ç¤ºæŠ¥å‘Šçš„ä¸‹è½½æ•°æ®å’Œè¶‹åŠ¿ã€‚</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon">ğŸ“ˆ</div>
                        <h5>æ€»ä¸‹è½½æ¬¡æ•°</h5>
                        <p id="totalDownloads">åŠ è½½ä¸­...</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon">â­</div>
                        <h5>æœ€å—æ¬¢è¿æŠ¥å‘Š</h5>
                        <p id="mostPopularReport">åŠ è½½ä¸­...</p>
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #ec4899;">æœ€è¿‘ä¸‹è½½è®°å½•</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šåç§°</th>
                            <th>ä¸‹è½½æ—¶é—´</th>
                            <th>ä¸‹è½½ç±»å‹</th>
                        </tr>
                    </thead>
                    <tbody id="downloadHistoryTableBody">
                        <!-- Download history will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- System Statistics Page -->
            <div id="systemStatsPage" class="page-content hidden">
                <button class="btn btn-secondary" onclick="switchToAdminPage('backup')" style="margin-bottom: 20px;">
                    â¬…ï¸ è¿”å›å¤‡ä»½å’Œä¸‹è½½
                </button>
                <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h2>
                <p>æ­¤å¤„æ˜¾ç¤ºç³»ç»Ÿå­˜å‚¨å’Œæ–‡ä»¶ä¸Šä¼ çš„æ•´ä½“æƒ…å†µã€‚</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon">ğŸ“</div>
                        <h5>æŠ¥å‘Šæ€»æ¡ç›®</h5>
                        <p id="totalReportsCount">åŠ è½½ä¸­...</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon">â¬†ï¸</div>
                        <h5>å·²ä¸Šä¼ HTMLæŠ¥å‘Š</h5>
                        <p id="uploadedHtmlCount">åŠ è½½ä¸­...</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon">â¬‡ï¸</div>
                        <h5>å·²ä¸Šä¼ PDFæŠ¥å‘Š</h5>
                        <p id="uploadedPdfCount">åŠ è½½ä¸­...</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ“„</div>
                        <h5>å·²ä¸Šä¼ ExcelæŠ¥å‘Š</h5>
                        <p id="uploadedExcelCount">åŠ è½½ä¸­...</p>
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #ec4899;">æŠ¥å‘Šç±»å‹åˆ†å¸ƒ</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šç±»å‹</th>
                            <th>HTMLæ•°é‡</th>
                            <th>PDFæ•°é‡</th>
                            <th>Excelæ•°é‡</th>
                        </tr>
                    </thead>
                    <tbody id="reportTypeStatsTableBody">
                        <!-- Report type statistics will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- File Management Page -->
            <div id="fileManagementPage" class="page-content hidden">
                <button class="btn btn-secondary" onclick="switchToAdminPage('backup')" style="margin-bottom: 20px;">
                    â¬…ï¸ è¿”å›å¤‡ä»½å’Œä¸‹è½½
                </button>
                <h2>ğŸ—‘ï¸ æ–‡ä»¶ç®¡ç†</h2>
                <p>æ­¤å¤„å¯ä»¥å¯¹å·²ä¸Šä¼ çš„æŠ¥å‘Šæ–‡ä»¶è¿›è¡Œç®¡ç†ï¼Œå¦‚åˆ é™¤æˆ–é‡æ–°ä¸Šä¼ ã€‚</p>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #ec4899;">æ‰€æœ‰å·²ä¸Šä¼ æŠ¥å‘Š</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šåç§°</th>
                            <th>ç±»å‹</th>
                            <th>æ—¥æœŸ</th>
                            <th>ä¸Šä¼ æ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="uploadedFilesTableBody">
                        <!-- Uploaded files list will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- Global variables and initialization ---
        // GitHub configuration
        let githubConfig = JSON.parse(localStorage.getItem('githubConfig')) || {};
        let isGitHubConnected = false;

        // Local storage fallback for reports data
        let reportsData = {};
        let downloadHistory = [];
        
        // Simulate admin password
        const ADMIN_PASSWORD = 'aroseisarose';

        // Page title and description data
        const pageInfo = {
            latest: { title: 'æœ€æ–°æŠ¥å‘Š', description: 'æŸ¥çœ‹å’Œç®¡ç†å½“å‰æœ€æ–°å‘å¸ƒçš„æŠ¥å‘Š' },
            history: { title: 'å†å²æŠ¥å‘Šå½’æ¡£', description: 'æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰å†å²æŠ¥å‘Šï¼Œæ”¯æŒç­›é€‰å’Œä¸‹è½½' },
            backup: { title: 'å¤‡ä»½å’Œä¸‹è½½', description: 'ç®¡ç†å‘˜åŠŸèƒ½ï¼šä¸Šä¼ æ–°æŠ¥å‘Šã€æ–‡ä»¶ç®¡ç†å’Œç»Ÿè®¡' },
            downloadStats: { title: 'ä¸‹è½½ç»Ÿè®¡', description: 'æŠ¥å‘Šä¸‹è½½è¶‹åŠ¿å’Œç»Ÿè®¡æ•°æ®' },
            systemStats: { title: 'ç³»ç»Ÿç»Ÿè®¡', description: 'ç³»ç»Ÿå­˜å‚¨å’ŒæŠ¥å‘Šä¸Šä¼ çš„æ•´ä½“æƒ…å†µ' },
            fileManagement: { title: 'æ–‡ä»¶ç®¡ç†', description: 'ç®¡ç†å·²ä¸Šä¼ çš„æŠ¥å‘Šæ–‡ä»¶ï¼Œå¦‚åˆ é™¤æˆ–é‡æ–°ä¸Šä¼ ' }
        };

        // --- Execute when DOM is fully loaded ---
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            setupNavigation();
            checkGitHubConnection();
            loadReportsData();
            loadLatestReports();
            updateReportsTable();
        });

        // --- GitHub Configuration Functions ---
        function checkGitHubConnection() {
            if (githubConfig.username && githubConfig.repo && githubConfig.token) {
                isGitHubConnected = true;
                updateGitHubStatus('GitHubå·²è¿æ¥');
                showConnectedBanner();
                loadReportsFromGitHub();
            } else {
                isGitHubConnected = false;
                updateGitHubStatus('GitHubæœªè¿æ¥');
                loadReportsFromLocal(); // Fallback to local storage
            }
        }

        function updateGitHubStatus(status) {
            const statusElement = document.getElementById('githubStatus');
            statusElement.textContent = status;
            if (status.includes('å·²è¿æ¥')) {
                statusElement.style.background = '#22c55e';
                statusElement.style.color = 'white';
            } else {
                statusElement.style.background = '#6366f1';
                statusElement.style.color = 'white';
            }
        }

        function showConnectedBanner() {
            const banner = document.getElementById('githubSetupBanner');
            banner.classList.add('connected');
            banner.innerHTML = `
                <div class="setup-info">
                    <span style="font-size: 1.5em;">âœ…</span>
                    <div>
                        <strong>GitHubäº‘ç«¯å­˜å‚¨å·²è¿æ¥</strong>
                        <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">ä»“åº“: ${githubConfig.username}/${githubConfig.repo}</p>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="toggleGitHubSetup()">é‡æ–°é…ç½®</button>
            `;
        }

        function toggleGitHubSetup() {
            const configDiv = document.getElementById('githubConfig');
            if (configDiv.style.display === 'none') {
                configDiv.style.display = 'block';
                // Pre-fill existing values
                document.getElementById('githubUsername').value = githubConfig.username || '';
                document.getElementById('githubRepo').value = githubConfig.repo || '';
                document.getElementById('githubToken').value = githubConfig.token || '';
            } else {
                configDiv.style.display = 'none';
            }
        }

        async function connectGitHub() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();

            if (!username || !repo || !token) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…éœ€çš„é…ç½®ä¿¡æ¯ï¼');
                return;
            }

            showLoading('æ­£åœ¨éªŒè¯GitHubè¿æ¥...');

            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok || response.status === 404) {
                    // Save configuration
                    githubConfig = { username, repo, token };
                    localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
                    
                    isGitHubConnected = true;
                    updateGitHubStatus('GitHubå·²è¿æ¥');
                    showConnectedBanner();
                    document.getElementById('githubConfig').style.display = 'none';
                    
                    hideLoading();
                    alert('âœ… GitHubè¿æ¥æˆåŠŸï¼\n\næ‚¨ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº‘ç«¯å­˜å‚¨åŠŸèƒ½äº†ã€‚');
                    
                    // Load reports from GitHub
                    await loadReportsFromGitHub();
                    loadLatestReports();
                    updateReportsTable();
                    
                } else if (response.status === 401) {
                    hideLoading();
                    alert('âŒ è®¿é—®ä»¤ç‰Œæ— æ•ˆï¼\n\nè¯·æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æ­£ç¡®ï¼Œå¹¶ç¡®ä¿å…·æœ‰repoæƒé™ã€‚');
                } else {
                    hideLoading();
                    alert('âŒ è¿æ¥å¤±è´¥ï¼\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé…ç½®ä¿¡æ¯ã€‚');
                }
            } catch (error) {
                hideLoading();
                alert('âŒ è¿æ¥å¤±è´¥ï¼\n\n' + error.message);
            }
        }

        // --- Data Loading Functions ---
        function loadReportsData() {
            if (isGitHubConnected) {
                loadReportsFromGitHub();
            } else {
                loadReportsFromLocal();
            }
        }

        function loadReportsFromLocal() {
            reportsData = JSON.parse(localStorage.getItem('reportsData')) || {};
            downloadHistory = JSON.parse(localStorage.getItem('downloadHistory')) || [];
        }

        async function loadReportsFromGitHub() {
            if (!isGitHubConnected) return;
            
            try {
                // Load reports index from GitHub
                const indexResponse = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/reports-index.json`, {
                    headers: { 'Authorization': `token ${githubConfig.token}` }
                });
                
                if (indexResponse.ok) {
                    const indexFile = await indexResponse.json();
                    const indexContent = atob(indexFile.content);
                    const data = JSON.parse(indexContent);
                    reportsData = data.reportsData || {};
                    downloadHistory = data.downloadHistory || [];
                } else {
                    // Initialize empty data if index doesn't exist
                    reportsData = {};
                    downloadHistory = [];
                }
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString();
                
            } catch (error) {
                console.error('Failed to load data from GitHub:', error);
                // Fallback to local storage
                loadReportsFromLocal();
            }
        }

        async function saveReportsToGitHub() {
            if (!isGitHubConnected) {
                // Fallback to local storage
                localStorage.setItem('reportsData', JSON.stringify(reportsData));
                localStorage.setItem('downloadHistory', JSON.stringify(downloadHistory));
                return;
            }
            
            try {
                const data = {
                    reportsData: reportsData,
                    downloadHistory: downloadHistory,
                    lastUpdate: new Date().toISOString()
                };
                
                const content = btoa(JSON.stringify(data, null, 2));
                
                // Check if index file exists
                let sha = null;
                try {
                    const existingFile = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/reports-index.json`, {
                        headers: { 'Authorization': `token ${githubConfig.token}` }
                    });
                    if (existingFile.ok) {
                        const fileData = await existingFile.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // File doesn't exist, that's fine
                }
                
                // Update or create index file
                const updateResponse = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/reports-index.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update reports index',
                        content: content,
                        ...(sha && { sha })
                    })
                });
                
                if (!updateResponse.ok) {
                    throw new Error('Failed to save to GitHub');
                }
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString();
                
            } catch (error) {
                console.error('Failed to save to GitHub:', error);
                // Fallback to local storage
                localStorage.setItem('reportsData', JSON.stringify(reportsData));
                localStorage.setItem('downloadHistory', JSON.stringify(downloadHistory));
            }
        }

        // --- Keep all existing functions from the original system ---
        
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('zh-CN', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }

        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const navToggle = document.getElementById('navToggle');
            const navSidebar = document.getElementById('navSidebar');

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');

                    if (['backup', 'downloadStats', 'systemStats', 'fileManagement'].includes(page)) {
                        if (sessionStorage.getItem('isAdminAuthenticated') === 'true') {
                            switchPage(page);
                        } else {
                            showAdminAuthModal(() => switchPage(page));
                        }
                    } else {
                        switchPage(page);
                    }

                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    if (window.innerWidth <= 1024) {
                        navSidebar.classList.remove('open');
                    }
                });
            });

            navToggle.addEventListener('click', function() {
                navSidebar.classList.toggle('open');
            });

            document.querySelector('.main-content').addEventListener('click', function() {
                if (window.innerWidth <= 1024 && navSidebar.classList.contains('open')) {
                    navSidebar.classList.remove('open');
                }
            });
        }

        function switchPage(page) {
            document.querySelectorAll('.page-content').forEach(p => {
                p.classList.add('hidden');
            });

            const targetPage = document.getElementById(page + 'Page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }

            const info = pageInfo[page];
            if (info) {
                document.getElementById('pageTitle').textContent = info.title;
                document.getElementById('pageDescription').textContent = info.description;
            }

            if (page === 'downloadStats') {
                updateDownloadStats();
            } else if (page === 'systemStats') {
                updateSystemStats();
            } else if (page === 'fileManagement') {
                updateFileManagementList();
            } else if (page === 'history') {
                filterReports();
            } else if (page === 'latest') {
                loadLatestReports();
            }
        }

        // æ–°å‡½æ•°ï¼šéœ€è¦ç®¡ç†å‘˜éªŒè¯çš„é¡µé¢è·³è½¬
        function switchToAdminPage(page) {
            if (sessionStorage.getItem('isAdminAuthenticated') === 'true') {
                switchPage(page);
                // æ›´æ–°å¯¼èˆªçŠ¶æ€
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                const targetNavItem = document.querySelector(`.nav-item[data-page="${page}"]`) || 
                                    document.querySelector(`.nav-item[data-page="backup"]`); // ç»Ÿè®¡é¡µé¢å½’å±äºbackup
                if (targetNavItem) {
                    targetNavItem.classList.add('active');
                }
            } else {
                showAdminAuthModal(() => {
                    switchPage(page);
                    // æ›´æ–°å¯¼èˆªçŠ¶æ€
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    const targetNavItem = document.querySelector(`.nav-item[data-page="${page}"]`) || 
                                        document.querySelector(`.nav-item[data-page="backup"]`); // ç»Ÿè®¡é¡µé¢å½’å±äºbackup
                    if (targetNavItem) {
                        targetNavItem.classList.add('active');
                    }
                });
            }
        }

        function showAdminAuthModal(callback) {
            const modal = document.getElementById('adminAuthModal');
            const passwordInput = document.getElementById('adminPasswordInput');
            passwordInput.value = '';
            modal.style.display = 'flex';
            modal.callback = callback;
        }

        function closeAdminAuthModal() {
            document.getElementById('adminAuthModal').style.display = 'none';
        }

        function checkAdminPassword() {
            const passwordInput = document.getElementById('adminPasswordInput');
            if (passwordInput.value === ADMIN_PASSWORD) {
                sessionStorage.setItem('isAdminAuthenticated', 'true');
                closeAdminAuthModal();
                if (document.getElementById('adminAuthModal').callback) {
                    document.getElementById('adminAuthModal').callback();
                }
            } else {
                alert('å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼');
                passwordInput.value = '';
            }
        }

        function showLoading(message = 'æ­£åœ¨æ‰§è¡Œæ“ä½œ...') {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function loadLatestReports() {
            // Clean up existing blob URLs
            cleanupBlobUrls();
            
            const now = new Date();
            const currentYearMonth = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}`;

            const latestTrendsReport = Object.values(reportsData)
                .filter(report => report.type === 'market-trends' && report.htmlUploaded)
                .sort((a, b) => {
                    const dateA = new Date(a.date.substring(0, 4), parseInt(a.date.substring(5, 7)) - 1);
                    const dateB = new Date(b.date.substring(0, 4), parseInt(b.date.substring(5, 7)) - 1);
                    return dateB - dateA;
                })[0];

            const latestDataReport = Object.values(reportsData)
                .filter(report => report.type === 'market-data' && report.htmlUploaded)
                .sort((a, b) => {
                    const dateA = new Date(a.date.substring(0, 4), parseInt(a.date.substring(5, 7)) - 1);
                    const dateB = new Date(b.date.substring(0, 4), parseInt(b.date.substring(5, 7)) - 1);
                    return dateB - dateA;
                })[0];

            renderReportCard('latestTrendsReportDisplay', latestTrendsReport, 'ğŸ“ˆ å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š', 'è¶‹åŠ¿HTMLæŠ¥å‘Š', 'PDF', 'market-trends');
            renderReportCard('latestDataReportDisplay', latestDataReport, 'ğŸ“Š å¸‚åœºæ•°æ®æœˆæŠ¥', 'æ•°æ®HTMLæŠ¥å‘Š', 'Excel', 'market-data');
        }

        function cleanupBlobUrls() {
            // æ¸…ç†ç°æœ‰çš„blob URLä»¥é˜²æ­¢å†…å­˜æ³„æ¼
            document.querySelectorAll('[data-blob-url]').forEach(element => {
                const blobUrl = element.dataset.blobUrl;
                if (blobUrl && blobUrl.startsWith('blob:')) {
                    URL.revokeObjectURL(blobUrl);
                }
                delete element.dataset.blobUrl;
            });
            
            // æ¸…ç†iframeå®¹å™¨ä¸­çš„blob URL
            document.querySelectorAll('[id^="iframe-container-"]').forEach(container => {
                const blobUrl = container.dataset.blobUrl;
                if (blobUrl && blobUrl.startsWith('blob:')) {
                    URL.revokeObjectURL(blobUrl);
                }
                delete container.dataset.blobUrl;
            });
        }

        async function renderReportCard(elementId, report, defaultTitle, htmlTypeLabel, downloadFileType, reportType) {
            const displayElement = document.getElementById(elementId);
            
            if (report) {
                displayElement.innerHTML = `
                    <div class="report-display">
                        <div class="report-header-card">
                            <div class="report-info">
                                <h3>${report.title}</h3>
                                <p>ä¸Šä¼ æ—¥æœŸ: ${report.uploadTime ? report.uploadTime.split(' ')[0] : report.date} | ç±»å‹: ${report.type === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥'}</p>
                            </div>
                            <div class="report-actions">
                                <button class="btn btn-primary" onclick="openReport('${report.key}')">
                                    ğŸ‘ï¸ æŸ¥çœ‹${htmlTypeLabel}
                                </button>
                                <button class="btn btn-secondary" ${report[downloadFileType.toLowerCase() + 'Uploaded'] ? '' : 'disabled'} onclick="downloadFile('${report.key}', '${downloadFileType.toLowerCase()}')">
                                    ğŸ“„ ä¸‹è½½${downloadFileType}
                                </button>
                            </div>
                        </div>
                        <div id="iframe-container-${report.key}" style="min-height: 600px; display: flex; align-items: center; justify-content: center; background: #f9fafb;">
                            <p>æ­£åœ¨åŠ è½½æŠ¥å‘Šå†…å®¹...</p>
                        </div>
                    </div>
                `;
                
                // Load content for iframe
                loadReportContent(report.key);
            } else {
                displayElement.innerHTML = `
                    <div class="no-report">
                        <div class="icon">${defaultTitle.includes('è¶‹åŠ¿') ? 'ğŸ“ˆ' : 'ğŸ“Š'}</div>
                        <h3>æš‚æ— æœ€æ–°${defaultTitle.replace(/.*\s/, '')}</h3>
                        <p>è¯·å…ˆä¸Šä¼ å½“å‰æœˆä»½çš„${htmlTypeLabel}æ–‡ä»¶</p>
                        <button class="btn btn-primary" onclick="switchToAdminPage('backup')" style="margin-top: 15px;">
                            ğŸ“¤ å»ä¸Šä¼ æŠ¥å‘Š
                        </button>
                    </div>
                `;
            }
        }

        async function loadReportContent(reportKey) {
            const report = reportsData[reportKey];
            const container = document.getElementById(`iframe-container-${reportKey}`);
            
            if (!container || !report || !report.htmlUploaded) {
                if (container) {
                    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #6b7280;">æ— æ³•åŠ è½½æŠ¥å‘Šå†…å®¹</p>';
                }
                return;
            }

            try {
                let htmlContent = '';
                
                if (isGitHubConnected && report.githubHtmlUrl) {
                    // ä»GitHubè·å–å†…å®¹ï¼ŒæŒ‡å®šUTF-8ç¼–ç 
                    const response = await fetch(report.githubHtmlUrl);
                    if (response.ok) {
                        // ç¡®ä¿ä»¥UTF-8ç¼–ç è¯»å–
                        const arrayBuffer = await response.arrayBuffer();
                        const decoder = new TextDecoder('utf-8');
                        htmlContent = decoder.decode(arrayBuffer);
                    } else {
                        throw new Error('Failed to fetch from GitHub');
                    }
                } else if (report.htmlContent) {
                    // ä½¿ç”¨æœ¬åœ°å†…å®¹
                    htmlContent = report.htmlContent;
                } else {
                    throw new Error('No content available');
                }

                // ç¡®ä¿HTMLå†…å®¹åŒ…å«æ­£ç¡®çš„ç¼–ç å£°æ˜
                if (!htmlContent.includes('<meta charset=') && !htmlContent.includes('<meta http-equiv="Content-Type"')) {
                    // å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼Œæ·»åŠ UTF-8ç¼–ç å£°æ˜
                    if (htmlContent.includes('<head>')) {
                        htmlContent = htmlContent.replace('<head>', '<head>\n<meta charset="UTF-8">');
                    } else if (htmlContent.includes('<html>')) {
                        htmlContent = htmlContent.replace('<html>', '<html>\n<head>\n<meta charset="UTF-8">\n</head>');
                    } else {
                        htmlContent = '<meta charset="UTF-8">\n' + htmlContent;
                    }
                }

                // åˆ›å»ºblob URLç”¨äºiframe
                const htmlBlob = new Blob([htmlContent], { type: 'text/html; charset=utf-8' });
                const blobUrl = URL.createObjectURL(htmlBlob);
                
                container.innerHTML = `<iframe class="report-iframe" src="${blobUrl}" frameborder="0"></iframe>`;
                
                // å­˜å‚¨ç”¨äºæ¸…ç†
                container.dataset.blobUrl = blobUrl;
                
            } catch (error) {
                console.error('Failed to load report content:', error);
                container.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #6b7280;">
                        <p>æ— æ³•åœ¨æ­¤å¤„é¢„è§ˆæŠ¥å‘Š</p>
                        <button class="btn btn-primary btn-sm" onclick="openReport('${reportKey}')" style="margin-top: 10px;">
                            ğŸ”— åœ¨æ–°çª—å£ä¸­æ‰“å¼€
                        </button>
                    </div>
                `;
            }
        }

        function triggerFileInput() {
            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            if (sessionStorage.getItem('isAdminAuthenticated') !== 'true') {
                showAdminAuthModal(() => {
                    document.getElementById('fileInput').click();
                });
                return;
            }
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            if (sessionStorage.getItem('isAdminAuthenticated') !== 'true') {
                showAdminAuthModal(() => {
                    const file = event.target.files[0];
                    if (file) {
                        processUpload(file);
                    }
                });
                return;
            }
            
            const file = event.target.files[0];
            if (file) {
                processUpload(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            if (sessionStorage.getItem('isAdminAuthenticated') !== 'true') {
                showAdminAuthModal(() => {
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        processUpload(files[0]);
                    }
                });
                return;
            }
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processUpload(files[0]);
            }
        }

        async function processUpload(file) {
            const fileName = file.name;
            
            const regex = /^(market-trends|market-data)-(\d{4})(\d{2})\.(html|htm|pdf|xls|xlsx)$/i; 
            const match = fileName.match(regex);
            
            if (!match) {
                alert('æ–‡ä»¶åæ ¼å¼é”™è¯¯æˆ–ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼\n\nè¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å‘½åï¼š\nâ€¢ market-trends-YYYYMM.html æˆ– .pdf\nâ€¢ market-data-YYYYMM.html æˆ– .xlsx (æˆ– .xls)\n\nä¾‹å¦‚ï¼šmarket-trends-202507.html æˆ– market-data-202507.xlsx');
                return;
            }
            
            const [, type, year, month, extension] = match;
            const reportKey = `${type}-${year}${month}`;

            showLoading(`æ­£åœ¨ä¸Šä¼ å¹¶å¤„ç†æ–‡ä»¶: ${fileName}...`);

            try {
                // Initialize report entry if it doesn't exist
                if (!reportsData[reportKey]) {
                    reportsData[reportKey] = {
                        key: reportKey,
                        type: type,
                        title: `${year}å¹´${parseInt(month)}æœˆ${type === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥'}`,
                        date: `${year}-${month}`,
                        htmlContent: null,
                        pdfContent: null,
                        excelContent: null,
                        htmlUploaded: false,
                        pdfUploaded: false,
                        excelUploaded: false,
                        downloads: 0, 
                        uploadTime: null,
                        githubHtmlUrl: null,
                        githubPdfUrl: null,
                        githubExcelUrl: null
                    };
                }

                // Read file content
                const fileContent = await readFileContent(file);
                
                // Store content and upload to GitHub if connected
                const lowerExtension = extension.toLowerCase();
                if (lowerExtension === 'html' || lowerExtension === 'htm') {
                    reportsData[reportKey].htmlContent = fileContent;
                    reportsData[reportKey].htmlUploaded = true;
                    
                    if (isGitHubConnected) {
                        const githubUrl = await uploadFileToGitHub(fileName, fileContent, 'text/html');
                        reportsData[reportKey].githubHtmlUrl = githubUrl;
                    }
                } else if (lowerExtension === 'pdf') {
                    reportsData[reportKey].pdfContent = fileContent;
                    reportsData[reportKey].pdfUploaded = true;
                    
                    if (isGitHubConnected) {
                        const githubUrl = await uploadFileToGitHub(fileName, fileContent, 'application/pdf');
                        reportsData[reportKey].githubPdfUrl = githubUrl;
                    }
                } else if (lowerExtension === 'xls' || lowerExtension === 'xlsx') {
                    reportsData[reportKey].excelContent = fileContent;
                    reportsData[reportKey].excelUploaded = true;
                    
                    if (isGitHubConnected) {
                        const githubUrl = await uploadFileToGitHub(fileName, fileContent, 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
                        reportsData[reportKey].githubExcelUrl = githubUrl;
                    }
                }

                reportsData[reportKey].uploadTime = new Date().toLocaleString();
                
                // Save data
                await saveReportsToGitHub();
                
                hideLoading();
                alert(`âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\n\næ–‡ä»¶å: ${fileName}\nç±»å‹: ${type === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥'}\næ—¥æœŸ: ${year}å¹´${parseInt(month)}æœˆ`);
                
                // Refresh displays
                loadLatestReports();
                updateReportsTable();
                switchPage('latest');
                
            } catch (error) {
                hideLoading();
                alert('âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
            }
        }

        async function uploadFileToGitHub(fileName, content, mimeType) {
            if (!isGitHubConnected) return null;
            
            try {
                let base64Content;
                if (typeof content === 'string' && mimeType === 'text/html') {
                    // å¯¹äºHTMLæ–‡ä»¶ï¼Œç¡®ä¿æ­£ç¡®çš„UTF-8ç¼–ç è½¬æ¢
                    const encoder = new TextEncoder();
                    const utf8Bytes = encoder.encode(content);
                    let binary = '';
                    utf8Bytes.forEach(byte => {
                        binary += String.fromCharCode(byte);
                    });
                    base64Content = btoa(binary);
                } else {
                    // å¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œcontentåº”è¯¥å·²ç»æ˜¯base64æ ¼å¼
                    base64Content = content.split(',')[1] || content;
                }
                
                const uploadPath = `reports/${fileName}`;
                
                // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                let sha = null;
                try {
                    const existingFile = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${uploadPath}`, {
                        headers: { 'Authorization': `token ${githubConfig.token}` }
                    });
                    if (existingFile.ok) {
                        const fileData = await existingFile.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ²¡å…³ç³»
                }
                
                const response = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${uploadPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Upload report: ${fileName}`,
                        content: base64Content,
                        ...(sha && { sha })
                    })
                });

                if (response.ok) {
                    const responseData = await response.json();
                    return responseData.content.download_url;
                } else {
                    throw new Error('GitHub upload failed');
                }
            } catch (error) {
                console.error('GitHub upload error:', error);
                return null;
            }
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                
                const lowerExtension = file.name.split('.').pop().toLowerCase();
                if (lowerExtension === 'pdf' || lowerExtension === 'xls' || lowerExtension === 'xlsx') {
                    reader.readAsDataURL(file);
                } else {
                    // å¯¹äºHTMLæ–‡ä»¶ï¼Œä½¿ç”¨UTF-8ç¼–ç è¯»å–
                    reader.readAsText(file, 'UTF-8');
                }
            });
        }

        function filterReports() {
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const type = document.getElementById('typeSelect').value;
            
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';

            const allPossibleReports = {};
            const now = new Date();
            const startYear = 2024;
            const endYear = now.getFullYear() + 1;

            for (let y = startYear; y <= endYear; y++) {
                for (let m = 1; m <= 12; m++) {
                    const monthStr = String(m).padStart(2, '0');
                    const keyTrends = `market-trends-${y}${monthStr}`;
                    const keyData = `market-data-${y}${monthStr}`;

                    if (!reportsData[keyTrends]) {
                        reportsData[keyTrends] = {
                            key: keyTrends,
                            type: 'market-trends',
                            title: `${y}å¹´${m}æœˆå¸‚åœºè¶‹åŠ¿æŠ¥å‘Š`,
                            date: `${y}-${monthStr}`,
                            htmlContent: null,
                            pdfContent: null,
                            excelContent: null,
                            htmlUploaded: false,
                            pdfUploaded: false,
                            excelUploaded: false,
                            downloads: 0,
                            uploadTime: null
                        };
                    }
                    allPossibleReports[keyTrends] = reportsData[keyTrends];

                    if (!reportsData[keyData]) {
                        reportsData[keyData] = {
                            key: keyData,
                            type: 'market-data',
                            title: `${y}å¹´${m}æœˆå¸‚åœºæ•°æ®æœˆæŠ¥`,
                            date: `${y}-${monthStr}`,
                            htmlContent: null,
                            pdfContent: null,
                            excelContent: null,
                            htmlUploaded: false,
                            pdfUploaded: false,
                            excelUploaded: false,
                            downloads: 0,
                            uploadTime: null
                        };
                    }
                    allPossibleReports[keyData] = reportsData[keyData];
                }
            }

            const filteredAndSortedReports = Object.values(allPossibleReports)
                .filter(report => {
                    const reportYear = report.date.substring(0, 4);
                    const reportMonth = report.date.substring(5, 7);
                    
                    const matchYear = (year === 'all' || reportYear === year);
                    const matchMonth = (month === 'all' || reportMonth === month);
                    const matchType = (type === 'all' || report.type === type);
                    
                    const reportDate = new Date(reportYear, parseInt(reportMonth) - 1);
                    const currentDate = new Date(now.getFullYear(), now.getMonth());

                    if (reportDate > currentDate && !report.htmlUploaded && !report.pdfUploaded && !report.excelUploaded) {
                        return false;
                    }

                    return matchYear && matchMonth && matchType;
                })
                .sort((a, b) => {
                    const dateA = new Date(a.date.substring(0, 4), parseInt(a.date.substring(5, 7)) - 1);
                    const dateB = new Date(b.date.substring(0, 4), parseInt(b.date.substring(5, 7)) - 1);
                    return dateB - dateA;
                });

            if (filteredAndSortedReports.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 20px; color: #9ca3af;">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æŠ¥å‘Šã€‚</td></tr>`;
                return;
            }

            filteredAndSortedReports.forEach(report => {
                const row = document.createElement('tr');
                row.setAttribute('data-year', report.date.substring(0, 4));
                row.setAttribute('data-month', report.date.substring(5, 7));
                row.setAttribute('data-type', report.type);
                
                const htmlStatusClass = report.htmlUploaded ? 'status-available' : 'status-missing';
                const htmlStatusText = report.htmlUploaded ? 'å·²ä¸Šä¼ ' : 'æœªä¸Šä¼ ';
                
                const pdfStatusClass = report.pdfUploaded ? 'status-available' : 'status-missing';
                const pdfStatusText = report.pdfUploaded ? 'å·²ä¸Šä¼ ' : 'æœªä¸Šä¼ ';

                const excelStatusClass = report.excelUploaded ? 'status-available' : (report.type === 'market-data' ? 'status-missing' : 'status-na');
                const excelStatusText = report.excelUploaded ? 'å·²ä¸Šä¼ ' : (report.type === 'market-data' ? 'æœªä¸Šä¼ ' : 'N/A');

                const viewDisabled = report.htmlUploaded ? '' : 'disabled';
                
                let downloadButtonHtml;
                if (report.type === 'market-data') {
                    downloadButtonHtml = `<button class="btn btn-secondary btn-sm" ${report.excelUploaded ? '' : 'disabled'} onclick="downloadFile('${report.key}', 'excel')">ä¸‹è½½</button>`;
                } else {
                    downloadButtonHtml = `<button class="btn btn-secondary btn-sm" ${report.pdfUploaded ? '' : 'disabled'} onclick="downloadFile('${report.key}', 'pdf')">ä¸‹è½½</button>`;
                }

                row.innerHTML = `
                    <td>${report.title}</td>
                    <td>${report.type === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥'}</td>
                    <td>${report.date}</td>
                    <td><span class="status-badge ${htmlStatusClass}">${htmlStatusText}</span></td>
                    <td><span class="status-badge ${pdfStatusClass}">${pdfStatusText}</span></td>
                    <td><span class="status-badge ${excelStatusClass}">${excelStatusText}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" ${viewDisabled} onclick="openReport('${report.key}')">æŸ¥çœ‹</button>
                            ${downloadButtonHtml}
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function resetFilters() {
            document.getElementById('yearSelect').value = 'all';
            document.getElementById('monthSelect').value = 'all';
            document.getElementById('typeSelect').value = 'all';
            filterReports();
        }

        function updateReportsTable() {
            filterReports();
        }

        async function openReport(reportKey) {
            const report = reportsData[reportKey];
            if (report && report.htmlUploaded) {
                try {
                    let htmlContent = '';
                    
                    if (isGitHubConnected && report.githubHtmlUrl) {
                        // ä»GitHubè·å–å†…å®¹
                        showLoading('æ­£åœ¨ä»GitHubåŠ è½½æŠ¥å‘Š...');
                        const response = await fetch(report.githubHtmlUrl);
                        if (response.ok) {
                            // ç¡®ä¿ä»¥UTF-8ç¼–ç è¯»å–
                            const arrayBuffer = await response.arrayBuffer();
                            const decoder = new TextDecoder('utf-8');
                            htmlContent = decoder.decode(arrayBuffer);
                        } else {
                            throw new Error('Failed to fetch from GitHub');
                        }
                        hideLoading();
                    } else if (report.htmlContent) {
                        // ä½¿ç”¨æœ¬åœ°å†…å®¹
                        htmlContent = report.htmlContent;
                    } else {
                        throw new Error('No content available');
                    }

                    // ç¡®ä¿HTMLå†…å®¹åŒ…å«æ­£ç¡®çš„ç¼–ç å£°æ˜
                    if (!htmlContent.includes('<meta charset=') && !htmlContent.includes('<meta http-equiv="Content-Type"')) {
                        // å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼Œæ·»åŠ UTF-8ç¼–ç å£°æ˜
                        if (htmlContent.includes('<head>')) {
                            htmlContent = htmlContent.replace('<head>', '<head>\n<meta charset="UTF-8">');
                        } else if (htmlContent.includes('<html>')) {
                            htmlContent = htmlContent.replace('<html>', '<html>\n<head>\n<meta charset="UTF-8">\n</head>');
                        } else {
                            htmlContent = '<meta charset="UTF-8">\n' + htmlContent;
                        }
                    }

                    // åˆ›å»ºblob URLå¹¶åœ¨æ–°çª—å£ä¸­æ‰“å¼€
                    const htmlBlob = new Blob([htmlContent], { type: 'text/html; charset=utf-8' });
                    const htmlBlobUrl = URL.createObjectURL(htmlBlob);
                    const newWindow = window.open(htmlBlobUrl, '_blank', 'width=1200,height=800');
                    newWindow.onbeforeunload = () => URL.revokeObjectURL(htmlBlobUrl);
                    
                } catch (error) {
                    hideLoading();
                    console.error('Failed to open report:', error);
                    alert('æ— æ³•æ‰“å¼€æŠ¥å‘Šï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚');
                }
            } else {
                alert('è¯¥æŠ¥å‘Šçš„HTMLç‰ˆæœ¬å°šæœªä¸Šä¼ ï¼Œæ— æ³•æŸ¥çœ‹ï¼');
            }
        }

        async function downloadFile(reportKey, fileType) {
            const report = reportsData[reportKey];
            let content;
            let mimeType;
            let fileNameSuffix;
            let uploadedStatus;
            let githubUrl;

            if (fileType === 'pdf') {
                content = report.pdfContent;
                mimeType = 'application/pdf';
                fileNameSuffix = '.pdf';
                uploadedStatus = report.pdfUploaded;
                githubUrl = report.githubPdfUrl;
            } else if (fileType === 'excel') {
                content = report.excelContent;
                mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                fileNameSuffix = '.xlsx';
                uploadedStatus = report.excelUploaded;
                githubUrl = report.githubExcelUrl;
            } else {
                alert('ä¸æ”¯æŒçš„ä¸‹è½½æ–‡ä»¶ç±»å‹ã€‚');
                return;
            }

            if (report && uploadedStatus) {
                // Increment download count
                reportsData[reportKey].downloads = (reportsData[reportKey].downloads || 0) + 1;
                downloadHistory.push({
                    reportKey: reportKey,
                    title: report.title,
                    timestamp: new Date().toLocaleString(),
                    type: fileType.toUpperCase()
                });
                
                await saveReportsToGitHub();

                // Download file
                let downloadUrl;
                if (isGitHubConnected && githubUrl) {
                    downloadUrl = githubUrl;
                } else {
                    downloadUrl = content;
                }
                
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${report.title.replace(/\s+/g, '')}${fileNameSuffix}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                if (document.getElementById('downloadStatsPage') && !document.getElementById('downloadStatsPage').classList.contains('hidden')) {
                    updateDownloadStats();
                }

            } else {
                alert(`è¯¥æŠ¥å‘Šçš„${fileType.toUpperCase()}ç‰ˆæœ¬å°šæœªä¸Šä¼ ï¼Œæ— æ³•ä¸‹è½½ï¼`);
            }
        }

        function showDownloadStats() {
            switchPage('downloadStats');
            updateDownloadStats();
        }

        function updateDownloadStats() {
            const totalDownloadsElement = document.getElementById('totalDownloads');
            const mostPopularReportElement = document.getElementById('mostPopularReport');
            const downloadHistoryTableBody = document.getElementById('downloadHistoryTableBody');

            let totalDownloads = 0;
            for (const key in reportsData) {
                totalDownloads += (reportsData[key].downloads || 0);
            }
            totalDownloadsElement.textContent = totalDownloads;

            let maxDownloads = -1;
            let popularReportTitle = 'æ— ';
            for (const key in reportsData) {
                if (reportsData[key].downloads > maxDownloads) {
                    maxDownloads = reportsData[key].downloads;
                    popularReportTitle = reportsData[key].title;
                }
            }
            mostPopularReportElement.textContent = popularReportTitle === 'æ— ' ? 'å°šæ— ä¸‹è½½' : `${popularReportTitle} (${maxDownloads} æ¬¡)`;

            downloadHistoryTableBody.innerHTML = '';
            if (downloadHistory.length === 0) {
                downloadHistoryTableBody.innerHTML = `<tr><td colspan="3" style="text-align: center; padding: 20px; color: #9ca3af;">å°šæ— ä¸‹è½½è®°å½•ã€‚</td></tr>`;
            } else {
                const sortedHistory = [...downloadHistory].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                sortedHistory.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.title}</td>
                        <td>${record.timestamp}</td>
                        <td>${record.type}</td>
                    `;
                    downloadHistoryTableBody.appendChild(row);
                });
            }
        }

        function showSystemStats() {
            switchPage('systemStats');
            updateSystemStats();
        }

        function updateSystemStats() {
            const totalReportsCountElement = document.getElementById('totalReportsCount');
            const uploadedHtmlCountElement = document.getElementById('uploadedHtmlCount');
            const uploadedPdfCountElement = document.getElementById('uploadedPdfCount');
            const uploadedExcelCountElement = document.getElementById('uploadedExcelCount');
            const reportTypeStatsTableBody = document.getElementById('reportTypeStatsTableBody');

            const allReportsArray = Object.values(reportsData);
            const totalReportKeys = allReportsArray.length;
            const htmlUploadedCount = allReportsArray.filter(r => r.htmlUploaded).length;
            const pdfUploadedCount = allReportsArray.filter(r => r.pdfUploaded).length;
            const excelUploadedCount = allReportsArray.filter(r => r.excelUploaded).length;

            totalReportsCountElement.textContent = totalReportKeys;
            uploadedHtmlCountElement.textContent = htmlUploadedCount;
            uploadedPdfCountElement.textContent = pdfUploadedCount;
            uploadedExcelCountElement.textContent = excelUploadedCount;

            const typeStats = {
                'market-trends': { html: 0, pdf: 0, excel: 0 },
                'market-data': { html: 0, pdf: 0, excel: 0 }
            };
            allReportsArray.forEach(report => {
                if (report.htmlUploaded && typeStats[report.type]) {
                    typeStats[report.type].html++;
                }
                if (report.pdfUploaded && typeStats[report.type]) {
                    typeStats[report.type].pdf++;
                }
                if (report.excelUploaded && typeStats[report.type]) {
                    typeStats[report.type].excel++;
                }
            });

            reportTypeStatsTableBody.innerHTML = '';
            for (const typeKey in typeStats) {
                const row = document.createElement('tr');
                const typeName = typeKey === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥';
                row.innerHTML = `
                    <td>${typeName}</td>
                    <td>${typeStats[typeKey].html}</td>
                    <td>${typeStats[typeKey].pdf}</td>
                    <td>${typeStats[typeKey].excel}</td>
                `;
                reportTypeStatsTableBody.appendChild(row);
            }
        }

        function showFileManagement() {
            switchPage('fileManagement');
            updateFileManagementList();
        }

        function updateFileManagementList() {
            const uploadedFilesTableBody = document.getElementById('uploadedFilesTableBody');
            uploadedFilesTableBody.innerHTML = '';

            const uploadedReports = Object.values(reportsData).filter(r => r.htmlUploaded || r.pdfUploaded || r.excelUploaded);

            if (uploadedReports.length === 0) {
                uploadedFilesTableBody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 20px; color: #9ca3af;">å°šæ— å·²ä¸Šä¼ çš„æ–‡ä»¶ã€‚</td></tr>`;
            } else {
                uploadedReports.sort((a, b) => new Date(b.uploadTime || 0) - new Date(a.uploadTime || 0));

                uploadedReports.forEach(report => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${report.title}</td>
                        <td>${report.type === 'market-trends' ? 'å¸‚åœºè¶‹åŠ¿æŠ¥å‘Š' : 'å¸‚åœºæ•°æ®æœˆæŠ¥'}</td>
                        <td>${report.date}</td>
                        <td>${report.uploadTime || 'N/A'}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm" onclick="deleteReport('${report.key}')">åˆ é™¤</button>
                        </td>
                    `;
                    uploadedFilesTableBody.appendChild(row);
                });
            }
        }

        async function deleteReport(reportKey) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æŠ¥å‘Š "${reportsData[reportKey].title}" å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰HTMLã€PDFå’ŒExcelç‰ˆæœ¬çš„æ•°æ®ã€‚`)) {
                delete reportsData[reportKey];
                
                downloadHistory = downloadHistory.filter(record => record.reportKey !== reportKey);
                await saveReportsToGitHub();

                alert('æŠ¥å‘Šå·²åˆ é™¤ã€‚');
                updateFileManagementList();
                loadLatestReports();
                updateReportsTable();
                updateDownloadStats();
                updateSystemStats();
            }
        }
    </script>
</body>
</html>